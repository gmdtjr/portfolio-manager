"""
포트폴리오 정밀 진단기 모듈
포트폴리오의 구조적 강점과 약점을 진단하고 최적화 방안을 제시하는 Deep Research 프롬프트를 생성합니다.
"""

from datetime import datetime


class PortfolioDiagnosisGenerator:
    """포트폴리오 정밀 진단 프롬프트 생성기"""
    
    def __init__(self):
        """초기화"""
        pass
    
    def generate_diagnosis_prompt(self) -> str:
        """
        포트폴리오 정밀 진단을 위한 최적화된
        Deep Research 프롬프트를 생성합니다.
        
        Returns:
            str: 생성된 포트폴리오 진단 프롬프트
        """
        today = datetime.now().strftime('%Y년 %m월 %d일')
        
        # 마스터 프롬프트 템플릿
        master_prompt_template = f"""# 포트폴리오 종합 진단 및 최적화 방안 보고서 ({today})

## [중요 지시사항]
- **역할 부여:** 당신은 나의 최종 의사결정을 돕기 위해, 포트폴리오의 **구조적인 강점(Strengths)과 약점(Weaknesses)을 모두 진단하는 '균형 잡힌 포트폴리오 전략가'**입니다. 당신의 임무는 결론을 내리는 것이 아니라, 내가 포트폴리오의 건강 상태를 종합적으로 이해하고 최적의 결정을 내릴 수 있도록 양질의 재료(양면적 분석)를 제공하는 것입니다.
- **언어:** 모든 결과물은 반드시 **한글**로만 작성해주세요.

## 분석 목표:
첨부된 2개의 포트폴리오 파일(`포트폴리오_현황.csv`, `투자_노트.csv`)을 종합적으로 분석하여, 현재 포트폴리오의 구조적 강점과 약점을 진단하고, 장기 수익률 개선을 위한 구체적인 최적화 방안을 제시하시오.

## 핵심 진단 항목:
*아래 4가지 항목에 대해, 각각의 강점과 잠재적 약점을 균형 있게 분석해주십시오.*

**1. 자산 배분 분석 (Asset Allocation):**
   - **강점:** 현재의 주식/현금 및 지역별 배분이 시장 기회를 포착하거나 리스크를 방어하는 데 있어 어떤 긍정적인 역할을 하고 있는가?
   - **잠재적 약점:** 현재의 자산 배분이 특정 시장 시나리오(예: 급격한 금리 인상, 특정 지역의 경기 침체)에서 노출할 수 있는 가장 큰 취약점은 무엇인가?

**2. 섹터 및 스타일 분석 (Sector & Style Analysis):**
   - **강점:** `투자_노트.csv`를 기준으로, 현재 집중하고 있는 섹터나 투자 스타일(성장주/가치주 등)이 거시적 트렌드와 부합하여 얻을 수 있는 가장 큰 기회는 무엇인가?
   - **잠재적 약점:** 특정 섹터나 스타일에 대한 편중이 심화될 경우 발생할 수 있는 가장 큰 리스크는 무엇이며, 현재 포트폴리오가 놓치고 있는 다른 유망 섹터나 스타일은 없는가?

**3. 분산 효과 분석 (Diversification Effect):**
   - **강점:** 포트폴리오 내에서 효과적으로 위험을 분산시켜주는 역할을 하는 종목이나 자산군은 무엇인가?
   - **잠재적 약점:** 표면적으로는 달라 보이지만 실제로는 유사한 리스크에 노출되어 있는 '숨겨진 상관관계'는 없는가? 이로 인해 시장 하락 시 분산 효과가 기대에 미치지 못할 위험은 없는가?

**4. '신념과 비중'의 일치도 분석 (Conviction vs. Weighting Alignment):**
   - **강점:** 나의 높은 투자 확신도와 실제 높은 비중이 일치하여, 나의 최고의 아이디어가 성과로 이어지고 있는 이상적인 경우는 무엇인가?
   - **잠재적 약점:** 나의 신념과 실제 비중의 불일치(확신은 낮으나 비중이 높거나, 확신은 높으나 비중이 낮은 경우)로 인해 발생할 수 있는 가장 큰 리스크 또는 기회비용은 무엇인가?

## 결과물 요구사항:

### **1. 종합 진단 (Overall Diagnosis)**
- **종합 건강 점수:** 포트폴리오의 전반적인 건강 상태를 A(매우 우수), B(양호), C(개선 필요), D(위험) 등급으로 평가하고, 가장 큰 강점과 가장 시급하게 개선이 필요한 약점을 각각 요약할 것.
- **항목별 진단:** 위 '핵심 진단 항목' 4가지 각각에 대해, 강점과 약점을 요약하고 A/B/C/D 등급을 부여할 것.

### **2. 최적화를 위한 고려사항 (Considerations for Optimization)**
- 진단 결과를 바탕으로, 포트폴리오를 더 건강하게 만들기 위해 내가 고려해볼 수 있는 구체적인 최적화 방안을 우선순위 순으로 2~3가지 제안할 것. (직접적인 '명령'이 아닌, 의사결정을 돕는 '제안'의 형태로 제시)
- **(예시)** "1. 기술주 편중 리스크 완화를 위해, 확신도가 낮은 A종목 비중을 점진적으로 줄이고, 그 자금을 현재 포트폴리오에 없는 헬스케어 섹터로 재배분하는 방안을 고려해볼 수 있습니다."

### **3. 핵심 모니터링 지표 (Key Monitoring Metrics)**
- 향후 포트폴리오 건강 상태를 지속적으로 추적하기 위해 주기적으로 점검해야 할 핵심 지표 3가지를 제시할 것.
- **(예시)** "1. 상위 1개 섹터의 비중 (50% 초과 시 위험 신호), 2. 포트폴리오와 시장 지수(예: S&P500)의 상관관계, 3. 최대 낙폭(MDD) 추이"
"""
        
        return master_prompt_template.strip()


def main():
    """테스트용 메인 함수"""
    print("🧪 포트폴리오 정밀 진단기 테스트")
    print("=" * 50)
    
    generator = PortfolioDiagnosisGenerator()
    
    print("📊 포트폴리오 진단 프롬프트 생성 중...")
    prompt = generator.generate_diagnosis_prompt()
    print(f"✅ 프롬프트 생성 완료 (길이: {len(prompt)}자)")
    print(f"📝 프롬프트 미리보기:\n{prompt[:300]}...")
    
    print("\n✅ 테스트가 완료되었습니다!")


if __name__ == "__main__":
    main()
