"""
ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨κΈ° λ¨λ“
ν¬νΈν΄λ¦¬μ¤μ κµ¬μ΅°μ  κ°•μ κ³Ό μ•½μ μ„ μ§„λ‹¨ν•κ³  μµμ ν™” λ°©μ•μ„ μ μ‹ν•λ” Deep Research ν”„λ΅¬ν”„νΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
"""

from datetime import datetime


class PortfolioDiagnosisGenerator:
    """ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨ ν”„λ΅¬ν”„νΈ μƒμ„±κΈ°"""
    
    def __init__(self):
        """μ΄κΈ°ν™”"""
        pass
    
    def generate_diagnosis_prompt(self) -> str:
        """
        ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨μ„ μ„ν• μµμ ν™”λ
        Deep Research ν”„λ΅¬ν”„νΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
        
        Returns:
            str: μƒμ„±λ ν¬νΈν΄λ¦¬μ¤ μ§„λ‹¨ ν”„λ΅¬ν”„νΈ
        """
        today = datetime.now().strftime('%Yλ…„ %mμ›” %dμΌ')
        
        # λ§μ¤ν„° ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ
        master_prompt_template = f"""# ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨ λ° μµμ ν™” λ°©μ• λ³΄κ³ μ„ ({today})

## **[μ¤‘μ” μ§€μ‹μ‚¬ν•­]**
- **λ¨λ“  κ²°κ³Όλ¬Όμ€ λ°λ“μ‹ ν•κΈ€λ΅λ§ μ‘μ„±ν•΄μ£Όμ„Έμ”.**
- μλ¬Έ μ©μ–΄λ” ν•„μ”ν• κ²½μ°μ—λ§ κ΄„νΈ μ•μ— λ³‘κΈ°ν•κ³ (μ: κ²½μ μ  ν•΄μ(Economic Moat)), κ·Έ μ™Έ λ¨λ“  μ„μ μ€ ν•κΈ€λ΅ ν•΄μ•Ό ν•©λ‹λ‹¤.

## **λ¶„μ„ λ©ν‘:**
μ²¨λ¶€λ 2κ°μ ν¬νΈν΄λ¦¬μ¤ νμΌ(`ν¬νΈν΄λ¦¬μ¤_ν„ν™©.csv`, `ν¬μ_λ…ΈνΈ.csv`)μ„ μΆ…ν•©μ μΌλ΅ λ¶„μ„ν•μ—¬, ν„μ¬ ν¬νΈν΄λ¦¬μ¤μ κµ¬μ΅°μ  κ°•μ κ³Ό μ•½μ μ„ μ§„λ‹¨ν•κ³ , μ¥κΈ° μμµλ¥  κ°μ„ μ„ μ„ν• κµ¬μ²΄μ μΈ μµμ ν™” λ°©μ•μ„ μ μ‹ν•μ‹μ¤.

## **ν•µμ‹¬ μ§„λ‹¨ ν•­λ©:**
*μ•„λ 4κ°€μ§€ ν•­λ©μ— λ€ν•΄ κΉμ΄ μκ² λ¶„μ„ν•κ³ , κ°κ°μ— λ€ν• ν‰κ°€λ¥Ό λ‚΄λ ¤μ£Όμ‹­μ‹μ¤.*

**1. μμ‚° λ°°λ¶„ λ¶„μ„ (Asset Allocation):**
   - **μ£Όμ‹/ν„κΈ λΉ„μ¤‘:** ν„μ¬μ μ£Όμ‹κ³Ό ν„κΈ λΉ„μ¤‘μ€ μ‹μ¥μ λ³€λ™μ„±μ„ κ³ λ ¤ν•  λ• λ°©μ–΄μ μΈκ°€, κ³µκ²©μ μΈκ°€?
   - **μ§€μ—­λ³„ λ°°λ¶„:** κµ­λ‚΄ μ£Όμ‹κ³Ό ν•΄μ™Έ μ£Όμ‹μ λΉ„μ¤‘μ€ μ μ ν•κ² λ¶„μ‚°λμ–΄ μλ”κ°€? νΉμ • μ§€μ—­μ μ§€μ •ν•™μ  λ¦¬μ¤ν¬μ— κ³Όλ„ν•κ² λ…Έμ¶λμ–΄ μμ§€λ” μ•μ€κ°€?

**2. μ„Ήν„° μ§‘μ¤‘λ„ λ¶„μ„ (Sector Concentration):**
   - **μ„Ήν„° νΈμ¤‘ λ¦¬μ¤ν¬:** `ν¬μ_λ…ΈνΈ.csv`μ 'μ„Ήν„°/μ‚°μ—…' λ¶„λ¥λ¥Ό κΈ°μ¤€μΌλ΅, νΉμ • μ„Ήν„°(μ: κΈ°μ μ£Ό, λ°λ„μ²΄)μ— λ€ν• νΈμ¤‘μ΄ μ‹¬ν•μ§€ μ•μ€κ°€?
   - **μ†μ™Έ μ„Ήν„° μ κ²€:** ν„μ¬ ν¬νΈν΄λ¦¬μ¤κ°€ λ†“μΉκ³  μλ” μ¤‘μ”ν• λ©”κ°€ νΈλ λ“λ‚ μ λ§ μ„Ήν„°λ” μ—†λ”κ°€?

**3. μΆ…λ© κ°„ μƒκ΄€κ΄€κ³„ λ¶„μ„ (Correlation Analysis):**
   - **λ¶„μ‚° ν¨κ³Ό μ κ²€:** ν¬νΈν΄λ¦¬μ¤ λ‚΄ μƒμ„ 5κ° μΆ…λ©λ“¤μ κ³Όκ±° μ£Όκ°€ μ›€μ§μ„μ„ λ¶„μ„ν–μ„ λ•, μ΄λ“¤μ΄ λ„λ¬΄ μ μ‚¬ν•κ² μ›€μ§μ—¬ μ‹μ¥ ν•λ½ μ‹ λ¶„μ‚° ν¨κ³Όλ¥Ό μ λ€λ΅ μ κ³µν•μ§€ λ»ν•  μ„ν—μ€ μ—†λ”κ°€?

**4. 'ν¬μ λ…ΈνΈ'μ™€ μ‹¤μ  ν¬νΈν΄λ¦¬μ¤μ κ΄΄λ¦¬ λ¶„μ„ (Conviction vs. Weighting):**
   - **μ‹ λ…κ³Ό λΉ„μ¤‘μ λ¶μΌμΉ:** `ν¬μ_λ…ΈνΈ.csv`μ™€ `ν¬νΈν΄λ¦¬μ¤_ν„ν™©.csv`λ¥Ό λΉ„κµν•μ—¬, λ‚μ ν¬μ μ•„μ΄λ””μ–΄λ‚ ν™•μ‹ λ„μ™€ μ‹¤μ  ν¬νΈν΄λ¦¬μ¤ λΉ„μ¤‘ μ‚¬μ΄μ— λ¨μμ μ€ μ—†λ”κ°€?
     - (μμ‹ 1) ν¬μ ν™•μ‹ λ„λ” 'ν•(Low)'μΈλ° λΉ„μ¤‘μ΄ μ—¬μ „ν λ†’μ€ μΆ…λ©μ€ μ—†λ”κ°€? (λ¦¬μ¤ν¬ κ΄€λ¦¬ μ‹¤ν¨)
     - (μμ‹ 2) ν¬μ ν™•μ‹ λ„λ” 'μƒ(High)'μΈλ° λΉ„μ¤‘μ΄ λ„λ¬΄ λ‚®μ•„ κΈ°νλΉ„μ©μ„ λ†“μΉκ³  μλ” μΆ…λ©μ€ μ—†λ”κ°€? (κ³Όκ°μ„± λ¶€μ΅±)

## **κ²°κ³Όλ¬Ό μ”κµ¬μ‚¬ν•­:**

### **1. μ§„λ‹¨ κ²°κ³Ό (Diagnosis Report)**
- **μΆ…ν•© κ±΄κ°• μ μ:** ν¬νΈν΄λ¦¬μ¤μ μ „λ°μ μΈ κ±΄κ°• μƒνƒλ¥Ό A(λ§¤μ° μ°μ), B(μ–‘νΈ), C(κ°μ„  ν•„μ”), D(μ„ν—) λ“±κΈ‰μΌλ΅ ν‰κ°€ν•κ³  κ·Έ μ΄μ λ¥Ό μ”μ•½ν•  κ²ƒ.
- **ν•­λ©λ³„ μ§„λ‹¨:** μ„ 'ν•µμ‹¬ μ§„λ‹¨ ν•­λ©' 4κ°€μ§€ κ°κ°μ— λ€ν•΄ A/B/C/D λ“±κΈ‰κ³Ό ν•¨κ» κµ¬μ²΄μ μΈ μ§„λ‹¨ κ·Όκ±°λ¥Ό μ μ‹ν•  κ²ƒ.

### **2. κ°μ„  μ μ• (Actionable Recommendations)**
- μ§„λ‹¨ κ²°κ³Όλ¥Ό λ°”νƒ•μΌλ΅, ν¬νΈν΄λ¦¬μ¤λ¥Ό λ” κ±΄κ°•ν•κ² λ§λ“¤κΈ° μ„ν• **κµ¬μ²΄μ μΈ λ¦¬λ°Έλ°μ‹± μ „λµ**μ„ μ°μ„ μμ„ μμΌλ΅ 2~3κ°€μ§€ μ μ•ν•  κ²ƒ.
- (μμ‹) "1. κΈ°μ μ£Ό νΈμ¤‘ λ¦¬μ¤ν¬ μ™„ν™”λ¥Ό μ„ν•΄, ν™•μ‹ λ„ λ‚®μ€ AμΆ…λ© λΉ„μ¤‘μ„ 5% μ¶•μ†ν•κ³ , μ†μ™Έλμ–΄ μλ Bν—¬μ¤μΌ€μ–΄ μ„Ήν„° νΈμ…μ„ κ³ λ ¤ν•μ‹­μ‹μ¤."

### **3. λ¨λ‹ν„°λ§ μ§€ν‘ (Monitoring KPIs)**
- ν–¥ν›„ ν¬νΈν΄λ¦¬μ¤ κ±΄κ°• μƒνƒλ¥Ό μ§€μ†μ μΌλ΅ μ¶”μ ν•κΈ° μ„ν•΄ μ£ΌκΈ°μ μΌλ΅ μ κ²€ν•΄μ•Ό ν•  ν•µμ‹¬ μ§€ν‘ 3κ°€μ§€λ¥Ό μ μ‹ν•  κ²ƒ.
- (μμ‹) "1. μ„Ήν„°λ³„ λΉ„μ¤‘ λ³€ν™”μ¨, 2. ν¬νΈν΄λ¦¬μ¤ λ² νƒ€ κ³„μ, 3. μµλ€ λ‚™ν­(MDD) μ¶”μ΄"
"""
        
        return master_prompt_template.strip()


def main():
    """ν…μ¤νΈμ© λ©”μΈ ν•¨μ"""
    print("π§ ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨κΈ° ν…μ¤νΈ")
    print("=" * 50)
    
    generator = PortfolioDiagnosisGenerator()
    
    print("π“ ν¬νΈν΄λ¦¬μ¤ μ§„λ‹¨ ν”„λ΅¬ν”„νΈ μƒμ„± μ¤‘...")
    prompt = generator.generate_diagnosis_prompt()
    print(f"β… ν”„λ΅¬ν”„νΈ μƒμ„± μ™„λ£ (κΈΈμ΄: {len(prompt)}μ)")
    print(f"π“ ν”„λ΅¬ν”„νΈ λ―Έλ¦¬λ³΄κΈ°:\n{prompt[:300]}...")
    
    print("\nβ… ν…μ¤νΈκ°€ μ™„λ£λμ—μµλ‹λ‹¤!")


if __name__ == "__main__":
    main()
