"""
ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨κΈ° λ¨λ“
ν¬νΈν΄λ¦¬μ¤μ κµ¬μ΅°μ  κ°•μ κ³Ό μ•½μ μ„ μ§„λ‹¨ν•κ³  μµμ ν™” λ°©μ•μ„ μ μ‹ν•λ” Deep Research ν”„λ΅¬ν”„νΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
"""

from datetime import datetime


class PortfolioDiagnosisGenerator:
    """ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨ ν”„λ΅¬ν”„νΈ μƒμ„±κΈ°"""
    
    def __init__(self):
        """μ΄κΈ°ν™”"""
        pass
    
    def generate_diagnosis_prompt(self) -> str:
        """
        ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨μ„ μ„ν• μµμ ν™”λ
        Deep Research ν”„λ΅¬ν”„νΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
        
        Returns:
            str: μƒμ„±λ ν¬νΈν΄λ¦¬μ¤ μ§„λ‹¨ ν”„λ΅¬ν”„νΈ
        """
        today = datetime.now().strftime('%Yλ…„ %mμ›” %dμΌ')
        
        # λ§μ¤ν„° ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ
        master_prompt_template = f"""# ν¬νΈν΄λ¦¬μ¤ μ¤νΈλ μ¤ ν…μ¤νΈ λ° λ¦¬μ¤ν¬ μ§„λ‹¨ λ³΄κ³ μ„ ({today})

## **[μ¤‘μ” μ§€μ‹μ‚¬ν•­]**
- **μ—­ν•  λ¶€μ—¬:** λ‹Ήμ‹ μ€ ν¬νΈν΄λ¦¬μ¤μ μ¨κ²¨μ§„ μ·¨μ•½μ μ„ μ°Ύμ•„λ‚΄λ” **'μµκ³  λ¦¬μ¤ν¬ μ±…μ„μ(Chief Risk Officer, CRO)'**μ…λ‹λ‹¤. λ‹Ήμ‹ μ μ„λ¬΄λ” λ‹¨μν κ°•μ κ³Ό μ•½μ μ„ λ‚μ—΄ν•λ” κ²ƒμ„ λ„μ–΄, μ΄ ν¬νΈν΄λ¦¬μ¤κ°€ λ―Έλμ μμƒμΉ λ»ν• μ¶©κ²©μ— μ–Όλ§λ‚ μ κ²¬λ” μ μλ”μ§€ **μ¤νΈλ μ¤ ν…μ¤νΈ(Stress Test)**λ¥Ό μν–‰ν•κ³ , **κ°€μ¥ μΉλ…μ μΈ λ‹¨μΌ μ‹¤ν¨ μ§€μ (Single Point of Failure)**μ„ μ°Ύμ•„λ‚΄λ” κ²ƒμ…λ‹λ‹¤.
- **μ–Έμ–΄:** λ¨λ“  κ²°κ³Όλ¬Όμ€ λ°λ“μ‹ **ν•κΈ€**λ΅λ§ μ‘μ„±ν•΄μ£Όμ„Έμ”.

## **λ¶„μ„ λ©ν‘:**
μ²¨λ¶€λ 2κ°μ ν¬νΈν΄λ¦¬μ¤ νμΌ(`ν¬νΈν΄λ¦¬μ¤_ν„ν™©.csv`, `ν¬μ_λ…ΈνΈ.csv`)μ„ λ°”νƒ•μΌλ΅, μ•„λ 'ν•µμ‹¬ μ§„λ‹¨ ν•­λ©'μ— λ”°λΌ ν¬νΈν΄λ¦¬μ¤μ— λ€ν• μ¤νΈλ μ¤ ν…μ¤νΈλ¥Ό μν–‰ν•κ³ , κ°€μ¥ μ‹κΈ‰ν•κ² λ³΄μ™„ν•΄μ•Ό ν•  μ·¨μ•½μ κ³Ό κ·Έμ— λ€ν• κµ¬μ²΄μ μΈ λ¦¬μ¤ν¬ κ΄€λ¦¬ λ°©μ•μ„ μ μ‹ν•μ‹μ¤.

## **ν•µμ‹¬ μ§„λ‹¨ ν•­λ© (Stress Test Scenarios):**
*μ•„λ 4κ°€μ§€ ν•­λ©μ— λ€ν•΄, κ°κ°μ μµμ•…μ μ‹λ‚λ¦¬μ¤λ¥Ό κ°€μ •ν•μ—¬ ν¬νΈν΄λ¦¬μ¤μ μ·¨μ•½μ μ„ λ¶„μ„ν•΄μ£Όμ‹­μ‹μ¤.*

**1. μμ‚° λ°°λ¶„ μ¤νΈλ μ¤ ν…μ¤νΈ (Asset Allocation Stress Test):**
   - **μ‹λ‚λ¦¬μ¤:** κ°€μƒμ μ‹μ¥ λ¶•κ΄΄(μ: κΈ€λ΅λ² μ¦μ‹ -20% κΈ‰λ½)κ°€ λ°μƒν–λ‹¤κ³  κ°€μ •ν–μ„ λ•, ν„μ¬ μμ‚° λ°°λ¶„μ μμƒ μµλ€ λ‚™ν­(MDD)μ€ μ–΄λ μμ¤€μ΄λ©°, λ³΄μ  ν„κΈμ€ μ΄λ¥Ό λ°©μ–΄ν•κ³  μ¶”κ°€ λ§¤μ κΈ°νλ΅ ν™μ©ν•κΈ°μ— μ¶©λ¶„ν•κ°€?

**2. μ§‘μ¤‘ ν¬μ λ¦¬μ¤ν¬ λ¶„μ„ (Concentration Risk Analysis):**
   - **μ‹λ‚λ¦¬μ¤:** `ν¬μ_λ…ΈνΈ.csv`λ¥Ό κΈ°μ¤€μΌλ΅ κ°€μ¥ λΉ„μ¤‘μ΄ λ†’μ€ μ„Ήν„°(μ: λ°λ„μ²΄)μ— λ€ν• **κ°€μ¥ λΉ„κ΄€μ μΈ λ‰΄μ¤(μ: νΉμ • κµ­κ°€μ μμ¶ ν†µμ  κ°•ν™”)**κ°€ λ°μƒν–λ‹¤κ³  κ°€μ •ν–μ„ λ•, ν•΄λ‹Ή μ„Ήν„°μ κΈ‰λ½μ΄ ν¬νΈν΄λ¦¬μ¤ μ „μ²΄μ— λ―ΈμΉλ” νκΈ‰ ν¨κ³Όμ™€ μ—°μ‡„μ μΈ μ†μ‹¤ κ·λ¨λ” μ–΄λ μ •λ„μΈκ°€?

**3. μ¨κ²¨μ§„ μƒκ΄€κ΄€κ³„ λ¶„μ„ (Hidden Correlation Analysis):**
   - **μ‹λ‚λ¦¬μ¤:** ν‘λ©΄μ μΌλ΅λ” λ‹¤λ¥Έ μ‚°μ—…μ μΆ…λ©μ²λΌ λ³΄μ΄μ§€λ§, μ‹¤μ λ΅λ” λ™μΌν• λ¦¬μ¤ν¬(μ: TSMC κ³µκΈ‰λ§ μμ΅΄, νΉμ • μ›μμ¬ κ°€κ²© κΈ‰λ“±)μ— λ…Έμ¶λμ–΄ μλ” **'μ¨κ²¨μ§„ ν΄λ¬μ¤ν„°'**κ°€ μ΅΄μ¬ν•λ”κ°€? μ΄ κ³µν†µ λ¦¬μ¤ν¬κ°€ ν„μ‹¤ν™”λ  κ²½μ°, λ¶„μ‚° ν¨κ³Όκ°€ μ‚¬λΌμ§€λ©΄μ„ μμƒλ³΄λ‹¤ ν° μ†μ‹¤μ΄ λ°μƒν•  κ°€λ¥μ„±μ€ μ—†λ”κ°€?

**4. 'μ‹ λ…κ³Ό λΉ„μ¤‘μ λ¶μΌμΉ' λ¦¬μ¤ν¬ (Conviction-Weighting Mismatch Risk):**
   - `ν¬μ_λ…ΈνΈ.csv`μ™€ `ν¬νΈν΄λ¦¬μ¤_ν„ν™©.csv`λ¥Ό λΉ„κµν•μ—¬, μ‹ λ…κ³Ό λΉ„μ¤‘μ λ¶μΌμΉλ΅ μΈν•΄ λ°μƒν•  μ μλ” κ°€μ¥ ν° λ¦¬μ¤ν¬λ” λ¬΄μ—‡μΈκ°€?
   - **(μμ‹ 1)** ν™•μ‹ λ„ 'ν•(Low)'μΈ μΆ…λ©μ λΉ„μ¤‘μ΄ λ†’μ•„, μμƒμΉ λ»ν• μ•…μ¬ λ°μƒ μ‹ ν° μ†μ‹¤κ³Ό ν•¨κ» **'μλ»λ μμ‚¬κ²°μ •μ— λ€ν• ν›„ν'**λΌλ” μ‹¬λ¦¬μ  νƒ€κ²©μ„ μ¤„ κ°€λ¥μ„±.
   - **(μμ‹ 2)** ν™•μ‹ λ„ 'μƒ(High)'μΈ μΆ…λ©μ λΉ„μ¤‘μ΄ λ„λ¬΄ λ‚®μ•„, ν•΄λ‹Ή μΆ…λ©μ΄ κΈ‰λ“±ν•  κ²½μ° **'κΈ°νλ¥Ό λ†“μΉ κ²ƒμ— λ€ν• μ•„μ‰¬μ›€'**μΌλ΅ μΈν•΄ μ¶”κ²© λ§¤μμ™€ κ°™μ€ λΉ„ν•©λ¦¬μ μΈ κ²°μ •μ„ λ‚΄λ¦΄ κ°€λ¥μ„±.

## **κ²°κ³Όλ¬Ό μ”κµ¬μ‚¬ν•­:**

### **1. λ¦¬μ¤ν¬ μ§„λ‹¨ μ”μ•½ (Risk Diagnosis Summary)**
- **μΆ…ν•© μ·¨μ•½μ„± λ“±κΈ‰ (Vulnerability Rating):** ν¬νΈν΄λ¦¬μ¤μ μ „λ°μ μΈ μ„κΈ° λ€μ‘ λ¥λ ¥μ„ A(λ§¤μ° κ²¬κ³ ), B(μ–‘νΈ), C(λ³΄μ™„ ν•„μ”), D(μ·¨μ•½) λ“±κΈ‰μΌλ΅ ν‰κ°€ν•κ³  κ·Έ μ΄μ λ¥Ό μ”μ•½ν•  κ²ƒ.
- **κ°€μ¥ μΉλ…μ μΈ μ·¨μ•½μ  (Single Point of Failure):** μ„ 4κ°€μ§€ ν…μ¤νΈ κ²°κ³Ό μ¤‘, ν„μ¬ ν¬νΈν΄λ¦¬μ¤μ μ•μ •μ„±μ„ κ°€μ¥ ν¬κ² μ„ν‘ν•λ” λ‹¨ ν•λ‚μ ν•µμ‹¬ μ·¨μ•½μ μ€ λ¬΄μ—‡μΈμ§€ λ…ν™•ν μ§μ–΄μ¤„ κ²ƒ.

### **2. λ¦¬μ¤ν¬ μ™„ν™” κ³„ν (Risk Mitigation Plan)**
- μ§„λ‹¨λ μ·¨μ•½μ μ„ λ³΄μ™„ν•κΈ° μ„ν• κµ¬μ²΄μ μΈ λ¦¬μ¤ν¬ κ΄€λ¦¬ λ°©μ•μ„ μ°μ„ μμ„ μμΌλ΅ 2~3κ°€μ§€ μ μ•ν•  κ²ƒ.
- **(μμ‹)** "1. μ¨κ²¨μ§„ λ°λ„μ²΄ κ³µκΈ‰λ§ λ¦¬μ¤ν¬ μ™„ν™”λ¥Ό μ„ν•΄, ιTSMC μμ΅΄λ„κ°€ λ†’μ€ BμΆ…λ©μ„ μΌλ¶€ νΈμ…ν•μ—¬ κΈ°μ μ£Ό λ‚΄ λ¦¬μ¤ν¬λ¥Ό λ¶„μ‚°μ‹ν‚¤λ” μ „λµμ„ κ³ λ ¤ν•μ‹­μ‹μ¤."

### **3. ν•µμ‹¬ λ¦¬μ¤ν¬ μ§€ν‘ (Key Risk Indicators, KRIs)**
- ν–¥ν›„ ν¬νΈν΄λ¦¬μ¤μ μ„ν— μμ¤€μ„ κ°€λ ν•κΈ° μ„ν•΄ μ£ΌκΈ°μ μΌλ΅ μ¶”μ ν•΄μ•Ό ν•  κ°€μ¥ μ¤‘μ”ν• λ°μ΄ν„° μ§€ν‘ 3κ°€μ§€λ¥Ό μ μ‹ν•  κ²ƒ.
- **(μμ‹)** "1. ν¬νΈν΄λ¦¬μ¤ μƒμ„ 3κ° μΆ…λ©μ λΉ„μ¤‘ ν•©κ³„, 2. νΉμ • μ„Ήν„°μ λΉ„μ¤‘, 3. ν¬νΈν΄λ¦¬μ¤ μ „μ²΄μ λ³€λ™μ„±(Beta)"
"""
        
        return master_prompt_template.strip()


def main():
    """ν…μ¤νΈμ© λ©”μΈ ν•¨μ"""
    print("π§ ν¬νΈν΄λ¦¬μ¤ μ •λ°€ μ§„λ‹¨κΈ° ν…μ¤νΈ")
    print("=" * 50)
    
    generator = PortfolioDiagnosisGenerator()
    
    print("π“ ν¬νΈν΄λ¦¬μ¤ μ§„λ‹¨ ν”„λ΅¬ν”„νΈ μƒμ„± μ¤‘...")
    prompt = generator.generate_diagnosis_prompt()
    print(f"β… ν”„λ΅¬ν”„νΈ μƒμ„± μ™„λ£ (κΈΈμ΄: {len(prompt)}μ)")
    print(f"π“ ν”„λ΅¬ν”„νΈ λ―Έλ¦¬λ³΄κΈ°:\n{prompt[:300]}...")
    
    print("\nβ… ν…μ¤νΈκ°€ μ™„λ£λμ—μµλ‹λ‹¤!")


if __name__ == "__main__":
    main()
